<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accessing and Analyzing Processed Data from R • MODIStsp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Accessing and Analyzing Processed Data from R">
<meta property="og:description" content="MODIStsp">
<meta property="og:image" content="http://docs.ropensci.org/MODIStsp/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-84499524-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-84499524-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MODIStsp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/interactive_execution.html">Interactive Execution - the MODIStsp GUI</a>
    </li>
    <li>
      <a href="../articles/noninteractive_execution.html">Non-Interactive Execution from within R</a>
    </li>
    <li>
      <a href="../articles/standalone_execution.html">Standalone Execution and Scheduled Processing</a>
    </li>
    <li>
      <a href="../articles/output.html">Outputs Format and Naming Conventions</a>
    </li>
    <li>
      <a href="../articles/analyze.html">Accessing and Analyzing Processed Data from R</a>
    </li>
    <li>
      <a href="../articles/products_list.html">Supported MODIS Products</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    faq
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/MODIStsp/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
<li>
  <a href="../articles/lorenzo.html">
    <span class="fa fa-cross"></span>
     
    dedication
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Accessing and Analyzing Processed Data from
R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/MODIStsp/blob/HEAD/vignettes/analyze.Rmd" class="external-link"><code>vignettes/analyze.Rmd</code></a></small>
      <div class="hidden name"><code>analyze.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="accessing-the-raster-time-series">
<i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i>
<strong>Accessing the raster time series</strong><a class="anchor" aria-label="anchor" href="#accessing-the-raster-time-series"></a>
</h2>
<p>Preprocessed MODIS data can be retrieved within <code>R</code> either
by accessing the single-date raster files, or by loading the saved
<code>RasterStack</code> objects (see <a href="output.html">here</a> for
a description of <a href="https://docs.ropensci.org/MODIStsp" class="external-link">MODIStsp</a> output folder structure and
naming conventions).</p>
<p>To test this functionality, you can run the following example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/MODIStsp" class="external-link">MODIStsp</a></span><span class="op">)</span></span>
<span><span class="va">opts_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata/test_extract.json"</span>, package <span class="op">=</span> <span class="st">"MODIStsp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/MODIStsp.html">MODIStsp</a></span><span class="op">(</span>opts_file <span class="op">=</span> <span class="va">opts_file</span>, gui <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This will download a yearly time series of MODIS NDVI data and subset
it over the region of the Como Lake in Italy.</p>
<p>After the download and processing finishes (it will take a while,
depending on your network speed), the MODIS time series will be placed
in subfolder <code>MODIStsp/VI_16Days_500m_v6</code> of <code>R</code>
<code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>. In this case, I have them in
“<code>file.path(tempdir(), "VI_16Days_500m_v6")</code>”. If you want to
save them elsewhere, run
<code>MODIStsp(opts_file = opts_file, gui = TRUE)</code> and select a
different output folder.</p>
<p>Single-date processed rasters can be accessed by simply opening them
with a <code>raster</code> command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modistsp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MODIStsp/VI_16Days_500m_v6/NDVI"</span>, <span class="st">"MOD13A1_NDVI_2016_177.tif"</span><span class="op">)</span></span>
<span><span class="va">modistsp_file</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpjwnHeK/MODIStsp/VI_16Days_500m_v6/NDVI/MOD13A1_NDVI_2016_177.tif"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">modistsp_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_raster</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p><code>RasterStack</code> (or GDAL vrt) time series containing all the
processed data for a given parameter are saved in the
<code>Time Series/RData</code> subfolder, and can be accessed by:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the NDVI time series</span></span>
<span><span class="va">ts_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MODIStsp/VI_16Days_500m_v6/Time_Series"</span><span class="op">)</span></span>
<span><span class="va">in_virtual_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ts_folder</span>, <span class="st">"RData/Terra/NDVI/MOD13A1_NDVI_1_2016_353_2016_RData.RData"</span><span class="op">)</span></span>
<span><span class="va">in_virtual_file</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpjwnHeK/MODIStsp/VI_16Days_500m_v6/Time_Series/RData/Terra/NDVI/MOD13A1_NDVI_1_2016_353_2016_RData.RData"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_data</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">in_virtual_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts_data</span></span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterStack </span></span>
<span><span class="co">## dimensions : 122, 65, 7930, 23  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">## resolution : 463.3127, 463.3127  (x, y)</span></span>
<span><span class="co">## extent     : 711648.3, 741763.7, 5076054, 5132578  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">## names      : MOD13A1_NDVI_2016_001, MOD13A1_NDVI_2016_017, MOD13A1_NDVI_2016_033, MOD13A1_NDVI_2016_049, MOD13A1_NDVI_2016_065, MOD13A1_NDVI_2016_081, MOD13A1_NDVI_2016_097, MOD13A1_NDVI_2016_113, MOD13A1_NDVI_2016_129, MOD13A1_NDVI_2016_145, MOD13A1_NDVI_2016_161, MOD13A1_NDVI_2016_177, MOD13A1_NDVI_2016_193, MOD13A1_NDVI_2016_209, MOD13A1_NDVI_2016_225, ... </span></span>
<span><span class="co">## time        : 2016-01-01 - 2016-12-18 (range)</span></span></code></pre>
<p>, which gives us a 23-band <code>RasterStack</code> in the
<code>ts_data</code> variable.</p>
<p>This <code>RasterStack</code> can be analyzed using the
functionalities for raster/raster time series analysis, extraction and
plotting provided for example by the <a href="https://rspatial.org/raster" class="external-link">raster</a> or
<a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a> packages:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot some dates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ts_data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, horizontal <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract one date from the stack</span></span>
<span></span>
<span><span class="va">mydate</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2016-01-01"</span><span class="op">)</span></span>
<span><span class="va">substack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ts_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/zvalues.html" class="external-link">getZ</a></span><span class="op">(</span><span class="va">ts_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">mydate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/zvalues.html" class="external-link">setZ</a></span><span class="op">(</span><span class="va">mydate</span><span class="op">)</span></span>
<span><span class="va">substack</span>  </span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterLayer </span></span>
<span><span class="co">## dimensions : 122, 65, 7930  (nrow, ncol, ncell)</span></span>
<span><span class="co">## resolution : 463.3127, 463.3127  (x, y)</span></span>
<span><span class="co">## extent     : 711648.3, 741763.7, 5076054, 5132578  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">## source     : MOD13A1_NDVI_2016_001.tif </span></span>
<span><span class="co">## names      : MOD13A1_NDVI_2016_001 </span></span>
<span><span class="co">## time       : 2016-01-01</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract multiple dates from the stack</span></span>
<span></span>
<span><span class="va">mindate</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2016-01-01"</span><span class="op">)</span></span>
<span><span class="va">maxdate</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2016-04-01"</span><span class="op">)</span></span>
<span><span class="va">substack</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ts_data</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/zvalues.html" class="external-link">getZ</a></span><span class="op">(</span><span class="va">ts_data</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">mindate</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/zvalues.html" class="external-link">getZ</a></span><span class="op">(</span><span class="va">ts_data</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">maxdate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">substack</span>  </span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterStack </span></span>
<span><span class="co">## dimensions : 122, 65, 7930, 6  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">## resolution : 463.3127, 463.3127  (x, y)</span></span>
<span><span class="co">## extent     : 711648.3, 741763.7, 5076054, 5132578  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">## names      : MOD13A1_NDVI_2016_001, MOD13A1_NDVI_2016_017, MOD13A1_NDVI_2016_033, MOD13A1_NDVI_2016_049, MOD13A1_NDVI_2016_065, MOD13A1_NDVI_2016_081 </span></span>
<span><span class="co">## time        : 2016-01-01, 2016-01-17, 2016-02-02, 2016-02-18, 2016-03-05, 2016-03-21</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute monthly averages</span></span>
<span></span>
<span><span class="va">month_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stackApply.html" class="external-link">stackApply</a></span><span class="op">(</span><span class="va">ts_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/zvalues.html" class="external-link">getZ</a></span><span class="op">(</span><span class="va">ts_data</span><span class="op">)</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">month_avg</span></span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterBrick </span></span>
<span><span class="co">## dimensions : 122, 65, 7930, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">## resolution : 463.3127, 463.3127  (x, y)</span></span>
<span><span class="co">## extent     : 711648.3, 741763.7, 5076054, 5132578  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">## source     : memory</span></span>
<span><span class="co">## names      : index_January, index_February, index_March, index_April,  index_May, index_June, index_July, index_August, index_September, index_October, index_November, index_December </span></span>
<span><span class="co">## min values :       -1891.0,        -1770.0,     -2000.0,     -1780.0,     -510.0,     -202.5,    -1347.0,       -275.0,         -1158.0,       -1944.0,        -2000.0,           -0.2 </span></span>
<span><span class="co">## max values :    9130.00000,     8888.00000,  8577.00000,  8699.50000, 9231.50000, 9284.50000, 9229.50000,   9110.50000,      9187.00000,    9173.00000,     9824.00000,        0.93525</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">month_avg</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, horizontal <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<hr>
</div>
<div class="section level2">
<h2 id="extracting-time-series-data-on-areas-of-interest">
<i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i>
<strong>Extracting Time Series Data on Areas of Interest</strong><a class="anchor" aria-label="anchor" href="#extracting-time-series-data-on-areas-of-interest"></a>
</h2>
<p><a href="https://docs.ropensci.org/MODIStsp" class="external-link">MODIStsp</a> provides an efficient function
(<code><a href="../reference/MODIStsp_extract.html">MODIStsp_extract()</a></code>) for extracting time series data at
specific locations. The function takes as input a
<code>RasterStack</code> virtual object created by
<code><a href="../reference/MODIStsp.html">MODIStsp()</a></code> (see above), the starting and ending dates for
the extraction and a standard <a href="https://github.com/edzer/sp/" class="external-link">sp</a> object (or an ESRI
shapefile name) specifying the locations (points, lines or polygons) of
interest, and provides as output a <code>xts</code> object or
<code>data.frame</code> containing time series data for those
locations.</p>
<p>If the input is of class <code>SpatialPoints</code>, the output
object contains one column for each point specified, and one row for
each date. If it is of class <code>SpatialPolygons</code> (or
<code>SpatialLines</code>), it contains one column for each polygon (or
each line), with values obtained applying the function specified as the
“FUN” argument (e.g., mean, standard deviation, etc.) on pixels
belonging to the polygon (or touched by the line), and one row for each
date.</p>
<p>To test <code><a href="../reference/MODIStsp_extract.html">MODIStsp_extract()</a></code> we can start by loading the
NDVI <code>RasterStack</code> time series created in the previous
example:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MODIStsp/VI_16Days_500m_v6/Time_Series"</span><span class="op">)</span></span>
<span><span class="va">in_virtual_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ts_folder</span>, <span class="st">"RData/Terra/NDVI/MOD13A1_NDVI_1_2016_353_2016_RData.RData"</span><span class="op">)</span></span>
<span><span class="va">ts_data</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">in_virtual_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ts_data</span></span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterStack </span></span>
<span><span class="co">## dimensions : 122, 65, 7930, 23  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">## resolution : 463.3127, 463.3127  (x, y)</span></span>
<span><span class="co">## extent     : 711648.3, 741763.7, 5076054, 5132578  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">## names      : MOD13A1_NDVI_2016_001, MOD13A1_NDVI_2016_017, MOD13A1_NDVI_2016_033, MOD13A1_NDVI_2016_049, MOD13A1_NDVI_2016_065, MOD13A1_NDVI_2016_081, MOD13A1_NDVI_2016_097, MOD13A1_NDVI_2016_113, MOD13A1_NDVI_2016_129, MOD13A1_NDVI_2016_145, MOD13A1_NDVI_2016_161, MOD13A1_NDVI_2016_177, MOD13A1_NDVI_2016_193, MOD13A1_NDVI_2016_209, MOD13A1_NDVI_2016_225, ... </span></span>
<span><span class="co">## time        : 2016-01-01 - 2016-12-18 (range)</span></span></code></pre>
<p>, which again gives us the 23-band <code>RasterStack</code> in the
<code>ts_data</code> variable.</p>
<p>To extract the NDVI data over selected areas, we can then use the
<code><a href="../reference/MODIStsp_extract.html">MODIStsp_extract()</a></code> function as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load a shapefile containing polygons --&gt; Here we use a test shapefile in </span></span>
<span><span class="co"># the testdata folder of MODIStsp.</span></span>
<span></span>
<span><span class="va">polygons</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata/extract_polys.shp"</span>,</span>
<span>                                       package <span class="op">=</span> <span class="st">"MODIStsp"</span><span class="op">)</span>,</span>
<span>                           quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">polygons</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 10 features and 2 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 9.248174 ymin: 45.91182 xmax: 9.526815 ymax: 46.18547</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">##    id      lc_type                       geometry</span></span>
<span><span class="co">## 1   1        Water POLYGON ((9.27148 46.05185,...</span></span>
<span><span class="co">## 2   2       Forest POLYGON ((9.3097 46.0122, 9...</span></span>
<span><span class="co">## 3   3      Urban_1 POLYGON ((9.334496 45.99779...</span></span>
<span><span class="co">## 4   4      Urban_2 POLYGON ((9.312293 45.9296,...</span></span>
<span><span class="co">## 5   5    Grassland POLYGON ((9.496195 46.02487...</span></span>
<span><span class="co">## 6   6     Cropland POLYGON ((9.441399 46.15214...</span></span>
<span><span class="co">## 7   7     Forest_2 POLYGON ((9.450375 46.10248...</span></span>
<span><span class="co">## 8   8      water_2 POLYGON ((9.35279 46.16475,...</span></span>
<span><span class="co">## 9   9 outside_poly POLYGON ((9.498727 46.18223...</span></span>
<span><span class="co">## 10 10   small_poly POLYGON ((9.364545 46.12664...</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now extract the average values for each polygon and date and plot the results</span></span>
<span></span>
<span><span class="va">out_dataavg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MODIStsp_extract.html">MODIStsp_extract</a></span><span class="op">(</span><span class="va">ts_data</span>, <span class="va">polygons</span>, id_field <span class="op">=</span> <span class="st">"lc_type"</span>, </span>
<span>                                small <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_dataavg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                Water   Forest Urban_1  Urban_2 Grassland Cropland Forest_2</span></span>
<span><span class="co">## 2016-01-01  1286.000 5205.000    4249 3645.444 4118.6667 5810.769 3617.222</span></span>
<span><span class="co">## 2016-01-17  4863.333 5264.333    4636 3279.889 3305.1667 5104.769 2183.111</span></span>
<span><span class="co">## 2016-02-02 -1408.000 5773.667    4458 3276.111 2037.5000 4964.385 2849.444</span></span>
<span><span class="co">## 2016-02-18    69.680 5532.667    3795 3705.333 -409.4000 6325.692 3286.222</span></span>
<span><span class="co">## 2016-03-05  1176.000 5070.000    3972 3759.333 -374.6667 6402.231 3586.556</span></span>
<span><span class="co">## 2016-03-21  1191.143 6197.333    4506 4226.889 2841.0000 7483.077 5281.000</span></span>
<span><span class="co">##              water_2 outside_poly</span></span>
<span><span class="co">## 2016-01-01 1637.2500           NA</span></span>
<span><span class="co">## 2016-01-17  624.5714           NA</span></span>
<span><span class="co">## 2016-02-02  207.5714           NA</span></span>
<span><span class="co">## 2016-02-18 2113.1000           NA</span></span>
<span><span class="co">## 2016-03-05 2195.0000           NA</span></span>
<span><span class="co">## 2016-03-21  383.2857           NA</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Other summarization functions can be used, by specifying the "FUN" argument. </span></span>
<span><span class="co"># Compute the Standard Deviation over each polygon: </span></span>
<span><span class="va">out_datasd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MODIStsp_extract.html">MODIStsp_extract</a></span><span class="op">(</span><span class="va">ts_data</span>, <span class="va">polygons</span>, id_field <span class="op">=</span> <span class="st">"lc_type"</span>,</span>
<span>                               FUN <span class="op">=</span> <span class="st">"sd"</span>, small <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The output is a <code>xts</code> object, with one column for each
polygon of the input shapefile, and one row for each date. We can easily
plot the computed averages using:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/xts" class="external-link">xts</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_dataavg</span>, legend.loc <span class="op">=</span> <span class="st">"topleft"</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can also transform the output dataset to a long format and use
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> for plotting and other tidyverse-friendly
functions for analysis:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">out_dataavg_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">out_dataavg</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">out_dataavg</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">Polygon</span>, <span class="va">Value</span>, <span class="op">-</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out_dataavg_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">Value</span>, color <span class="op">=</span> <span class="va">Polygon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/tibbletime" class="external-link">tibbletime</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute monthly averages using tibbletime: </span></span>
<span></span>
<span><span class="va">out_dataavg_tt</span> <span class="op">&lt;-</span> <span class="fu">tibbletime</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tibbletime/man/tbl_time.html" class="external-link">as_tbl_time</a></span><span class="op">(</span><span class="va">out_dataavg_df</span>, index <span class="op">=</span> <span class="va">date</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">month_avg</span> <span class="op">&lt;-</span> <span class="va">out_dataavg_tt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Polygon</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tibbletime</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tibbletime/man/as_period.html" class="external-link">as_period</a></span><span class="op">(</span>period <span class="op">=</span> <span class="st">"monthly"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">month_avg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">Value</span>, color <span class="op">=</span> <span class="va">Polygon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p><strong>Important note:</strong> <code><a href="../reference/MODIStsp_extract.html">MODIStsp_extract()</a></code> is
usually much faster than the standard <code><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">raster::extract()</a></code>
function, but does not deal with overlapping polygons. If your polygons
are overlapping, please use <code><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">raster::extract()</a></code> instead.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lorenzo Busetto, Luigi Ranghetti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
